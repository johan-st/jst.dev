<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Conduit</title>

    <!-- Import Ionicon icons & Google Fonts our Bootstrap theme relies on -->
    <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">

    <!-- GOOGLE FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oleo+Script:wght@700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/assets/main.css">

    <script src='https://js-de.sentry-cdn.com/f4758962110421a1ed08360be896a9bc.min.js' crossorigin="anonymous"></script>
    <script src="/assets/elm.js"></script>
  </head>
  <body>
    <script>
      Sentry.captureMessage("Hello from Elm!");
      try {
        throw new Error("Hello from Elm!");
      } catch (e) {
        Sentry.captureException(e);
      }
      console.log("Hello from Elm!");
      var storageKey = "store";
      var flags = localStorage.getItem(storageKey);
      var app = Elm.Main.init({flags: flags});

      app.ports.storeCache.subscribe(function(val) {

        if (val === null) {
          localStorage.removeItem(storageKey);
        } else {
          localStorage.setItem(storageKey, JSON.stringify(val));
        }

      // Report that the new session was stored successfully.
      setTimeout(function () { app.ports.onStoreChange.send(val); }, 0);
    });

    /* LOGGING */
    app.ports.debug.subscribe(function (msg) {
      Sentry.captureMessage(msg, "debug");
      console.debug(msg);
    });
    app.ports.error.subscribe(function (msg) {
      Sentry.captureMessage(msg, "error");
      console.error(msg);
    });

      // Whenever localStorage changes in another tab, report it if necessary.
      window.addEventListener("storage", function(event) {
        if (event.storageArea === localStorage && event.key === storageKey) {
          app.ports.onStoreChange.send(event.newValue);
        }
      }, false);
    </script>
  </body>
</html>
